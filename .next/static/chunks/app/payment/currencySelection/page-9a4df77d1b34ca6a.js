(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4663],{3524:(e,t,r)=>{Promise.resolve().then(r.bind(r,4716))},4716:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var a=r(5155),s=r(2115),n=r(5695);function o(){let e=(0,n.useRouter)(),[t,r]=(0,s.useState)(""),[o,i]=(0,s.useState)(!1),[c,l]=(0,s.useState)([]),[d,u]=(0,s.useState)(!0),[h,m]=(0,s.useState)(null),[g,x]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=localStorage.getItem("currency");e&&(r(e),i(!0)),(async()=>{let e=localStorage.getItem("token");if(!e){m("Authentication required. Please login first."),u(!1);return}try{u(!0);let a=await fetch("http://13.61.105.209/api/currency/list",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}});if(!a.ok){if(401===a.status){m("Session expired. Please login again.");return}if(403===a.status){m("You do not have permission to access this resource.");return}throw Error("Failed to fetch currencies: ".concat(a.statusText))}let s=await a.json();if(!s.status)throw Error(s.message||"Failed to fetch currencies");if(!Array.isArray(s.data))throw Error("Invalid response format from server");let n=s.data.filter(e=>e.isActive);if(0===n.length)throw Error("No active currencies found");l(n),m(null);let o=n.find(e=>e.isDefault);o&&!t&&(r(o.code),i(!0),localStorage.setItem("currency",o.code))}catch(e){console.error("Error fetching currencies:",e),m(e instanceof Error?e.message:"Failed to fetch currencies"),l([{_id:"fallback-usd",code:"USD",name:"US Dollar",symbol:"$",isActive:!0,isDefault:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{_id:"fallback-eur",code:"EUR",name:"Euro",symbol:"€",isActive:!0,isDefault:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{_id:"fallback-gbp",code:"GBP",name:"British Pound",symbol:"\xa3",isActive:!0,isDefault:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{_id:"fallback-inr",code:"INR",name:"Indian Rupee",symbol:"₹",isActive:!0,isDefault:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}])}finally{u(!1)}})()},[t]);let p=async()=>{if(!t)return;let r=c.find(e=>e.code===t);if(!r){m("Invalid currency selection");return}x(!0),m(null);try{let a=localStorage.getItem("token");if(!a)throw Error("Authentication required");let s=await fetch("http://13.61.105.209/api/subscription/update-preferred-currency",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({currencyId:r._id})});if(!s.ok){let e=await s.json();throw Error(e.message||"Failed to update currency")}let n=await s.json();if(n.message&&n.message.toLowerCase().includes("error"))throw Error(n.message);localStorage.setItem("currency",t),e.push("/payment/planSelection")}catch(e){console.error("Error updating currency:",e),m(e instanceof Error?e.message:"Failed to update currency")}finally{x(!1)}};return h?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,a.jsx)("div",{className:"max-w-md w-full mx-auto bg-white rounded-lg shadow-lg p-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-red-600",children:"Error"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:h}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-[#987CF1] text-white rounded-lg hover:bg-[#8769E0]",children:"Try Again"})]})})}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"max-w-md w-full mx-auto bg-white rounded-lg shadow-lg p-8",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Select Your Currency"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Choose the currency you'll use for your business transactions"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("select",{value:t,onChange:e=>{let t=e.target.value;r(t),i(!!t),localStorage.setItem("currency",t)},disabled:d||g,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#987CF1] focus:border-transparent appearance-none bg-white disabled:bg-gray-100",children:[(0,a.jsx)("option",{value:"",children:"Select a currency"}),c.map(e=>(0,a.jsxs)("option",{value:e.code,children:[e.code," - ",e.name," (",e.symbol,")"]},e._id))]}),(0,a.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none",children:d?(0,a.jsxs)("svg",{className:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})})]}),h&&(0,a.jsx)("div",{className:"p-4 bg-red-50 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:h})}),(0,a.jsx)("div",{className:"flex justify-end gap-4",children:(0,a.jsx)("button",{onClick:p,disabled:!t||d||g,className:"px-4 py-2 bg-[#987CF1] text-white rounded-lg hover:bg-[#8769E0] disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Save Changes"})})]})]})})}},5695:(e,t,r)=>{"use strict";var a=r(8999);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})}},e=>{var t=t=>e(e.s=t);e.O(0,[8441,1684,7358],()=>t(3524)),_N_E=e.O()}]);